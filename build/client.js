// Generated by CoffeeScript 1.6.1
(function() {
  var activeUser, compileMessage, connect, decompileMessage, dh, displayInfo, init, sendMessage, ws;

  dh = void 0;

  ws = void 0;

  activeUser = void 0;

  init = function() {
    dh = new window.DOMHandle();
    dh.initDOMChange();
    activeUser = "User_01";
    dh.on("submit", function(text) {
      return sendMessage({
        timeStamp: Date.now(),
        fromUser: activeUser,
        toUser: "global",
        content: text.content
      });
    });
    return connect();
  };

  sendMessage = function(messageObject) {
    return ws.send(compileMessage(messageObject));
  };

  displayInfo = function(info) {
    return dh.chatStatus.html(info);
  };

  compileMessage = function(messageObject) {
    var compiledMessage, content, fromUser, timeStamp, toUser;
    timeStamp = messageObject.timeStamp;
    toUser = messageObject.toUser;
    fromUser = messageObject.fromUser;
    content = messageObject.content.replace("|", "");
    return compiledMessage = "" + timeStamp + "|" + toUser + "|" + fromUser + "|" + content;
  };

  decompileMessage = function(message) {
    var messageObject, split;
    split = message.data.split("|");
    return messageObject = {
      timeStamp: split[0],
      toUser: split[1],
      fromUser: split[2],
      content: split[3]
    };
  };

  connect = function() {
    ws = new WebSocket("ws://arch.jvester.se:1337");
    dh.chatStatus.html("Connecting...");
    ws.onopen = function() {
      displayInfo("Connection established to " + ws.url);
      return displayInfo("Connection status: " + ws.readyState);
    };
    return ws.onmessage = function(message) {
      return dh.addMessageToPage(decompileMessage(message));
    };
  };

  init();

}).call(this);
