// Generated by CoffeeScript 1.6.1
(function() {
  var MessageSerializer, config, connect, dh, displayInfo, init, sendMessage, ws;

  dh = void 0;

  ws = void 0;

  window.activeUser = "User_0123";

  MessageSerializer = window.MessageSerializer;

  config = {
    server: "ws://arch.jvester.se:1337"
  };

  init = function() {
    dh = new window.DOMHandle();
    dh.initDOMChange();
    dh.chatTextarea.attr("placeholder", "Enter your desired username.");
    dh.on("submit", function(text) {
      window.activeUser = text.content;
      dh.chatTextarea.attr("placeholder", "Enter your message here.");
      return dh.on("submit", function(text) {
        return sendMessage({
          timeStamp: Date.now(),
          fromUser: window.activeUser,
          toUser: "global",
          content: text.content
        });
      });
    });
    return connect(config);
  };

  sendMessage = function(messageObject) {
    return ws.send(MessageSerializer.serialize(messageObject));
  };

  displayInfo = function(info) {
    return dh.chatStatus.html(info);
  };

  connect = function(config) {
    ws = new WebSocket(config.server);
    dh.chatStatus.html("Connecting...");
    ws.onopen = function() {
      displayInfo("Connection established to " + ws.url);
      return displayInfo("Connection status: " + ws.readyState);
    };
    return ws.onmessage = function(message) {
      return dh.addMessageToPage(MessageSerializer.deserialize(message.data));
    };
  };

  init();

}).call(this);
