// Generated by CoffeeScript 1.6.1
(function() {
  var WebSocketServer, clients, log, logMsg, logServerInfo, logUserInfo, message, port, wss;

  WebSocketServer = require("ws").Server;

  log = require("util").log;

  message = require("message");

  logMsg = function(msg) {
    return log("> " + msg);
  };

  logServerInfo = function(info) {
    return log("# " + info);
  };

  logUserInfo = function(info) {
    return log("@ " + info);
  };

  port = 1337;

  wss = new WebSocketServer({
    port: port
  });

  clients = [];

  logServerInfo("Initated on port " + port);

  wss.on("connection", function(ws) {
    logUserInfo("User connected.");
    clients.push(ws);
    ws.on("message", function(message) {
      var client, _i, _len, _results;
      logMsg(message);
      _results = [];
      for (_i = 0, _len = clients.length; _i < _len; _i++) {
        client = clients[_i];
        _results.push(client.send(message));
      }
      return _results;
    });
    return ws.on("close", function(code, message) {
      var client, i, _i, _len, _results;
      _results = [];
      for (i = _i = 0, _len = clients.length; _i < _len; i = ++_i) {
        client = clients[i];
        if (client === ws) {
          _results.push(clients.splice(i, 1));
        }
      }
      return _results;
    });
  });

}).call(this);
